name: "Response Body Types"
description: "Test handling of different response body types and content"

backend:
  endpoints:
    - path: /api/json
      method: GET
      response:
        status: 200
        headers:
          Content-Type: application/json
        body: '{"name":"John","age":30,"active":true}'

    - path: /api/text
      method: GET
      response:
        status: 200
        headers:
          Content-Type: text/plain
        body: 'Plain text response'

    - path: /api/html
      method: GET
      response:
        status: 200
        headers:
          Content-Type: text/html
        body: '<html><body><h1>Hello</h1></body></html>'

    - path: /api/empty
      method: GET
      response:
        status: 200
        body: ''

    - path: /api/large
      method: GET
      response:
        status: 200
        headers:
          Content-Type: application/json
        body: '{"data":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."}'

uncors:
  http-port: 3005
  mappings:
    - from: http://test.local:3005
      to: "{{backend}}"

tests:
  - name: "JSON response"
    requests:
      - method: GET
        path: /api/json
        headers:
          User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
          Accept: application/json, text/plain, */*
          Accept-Encoding: gzip, deflate, br
          Accept-Language: en-US,en;q=0.9
          Connection: keep-alive
    expected:
      status: 200
      headers:
        Content-Type: application/json
      body-json:
        name: John
        active: true
      body-contains:
        - '"age":30'

  - name: "Plain text response"
    requests:
      - method: GET
        path: /api/text
        headers:
          User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/121.0
          Accept: text/plain, text/*, */*
          Accept-Encoding: gzip, deflate, br
          Accept-Language: en-US,en;q=0.9
          Connection: keep-alive
    expected:
      status: 200
      headers:
        Content-Type: text/plain
      body: 'Plain text response'

  - name: "HTML response"
    requests:
      - method: GET
        path: /api/html
        headers:
          User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Safari/605.1.15
          Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
          Accept-Encoding: gzip, deflate
          Accept-Language: en-US,en;q=0.9
          Connection: keep-alive
    expected:
      status: 200
      headers:
        Content-Type: text/html
      body-contains:
        - '<html>'
        - '<h1>Hello</h1>'

  - name: "Empty response"
    requests:
      - method: GET
        path: /api/empty
        headers:
          User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1
          Accept: "*/*"
          Accept-Encoding: gzip, deflate
          Accept-Language: en-US,en;q=0.9
          Connection: keep-alive
    expected:
      status: 200
      body: ''

  - name: "Large response"
    requests:
      - method: GET
        path: /api/large
        headers:
          User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/121.0
          Accept: application/json
          Accept-Encoding: gzip, deflate, br
          Accept-Language: en-US,en;q=0.9
          Connection: keep-alive
          DNT: "1"
    expected:
      status: 200
      body-contains:
        - 'Lorem ipsum'
        - 'consectetur adipiscing'
