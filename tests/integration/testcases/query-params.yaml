name: "Query Parameters"
description: "Test forwarding of query parameters"

backend:
  endpoints:
    - path: /api/search
      method: GET
      response:
        status: 200
        headers:
          Content-Type: application/json
        body: '{"query":"received","results":[]}'

    - path: /api/filter
      method: GET
      response:
        status: 200
        headers:
          Content-Type: application/json
        body: '{"filters":"applied"}'

uncors:
  http-port: 3007
  mappings:
    - from: http://test.local:3007
      to: "{{backend}}"

tests:
  - name: "Single query parameter"
    requests:
      - method: GET
        url: http://test.local:3007/api/search?q=test
        headers:
          User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
          Accept: application/json, text/plain, */*
          Accept-Encoding: gzip, deflate, br
          Accept-Language: en-US,en;q=0.9
          Connection: keep-alive
          Cache-Control: no-cache
    expected:
      status: 200
      body-contains:
        - "query"

  - name: "Multiple query parameters"
    requests:
      - method: GET
        url: http://test.local:3007/api/filter?category=books&sort=price&order=asc
        headers:
          User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/121.0
          Accept: application/json
          Accept-Encoding: gzip, deflate, br
          Accept-Language: en-US,en;q=0.9
          Connection: keep-alive
          DNT: "1"
    expected:
      status: 200
      body-contains:
        - "filters"

  - name: "Query parameters with special characters"
    requests:
      - method: GET
        url: http://test.local:3007/api/search?q=hello%20world&lang=en-US
        headers:
          User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Safari/605.1.15
          Accept: application/json, text/plain, */*
          Accept-Encoding: gzip, deflate
          Accept-Language: en-US,en;q=0.9,es;q=0.8
          Connection: keep-alive
    expected:
      status: 200
