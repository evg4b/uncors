name: "Request Body Handling"
description: "Test forwarding of different request body types"

backend:
  endpoints:
    - path: /api/data
      method: POST
      response:
        status: 201
        headers:
          Content-Type: application/json
        body: '{"received":true}'

    - path: /api/form
      method: POST
      response:
        status: 200
        headers:
          Content-Type: application/json
        body: '{"form":"processed"}'

uncors:
  http-port: 3008
  mappings:
    - from: http://test.local:3008
      to: "{{backend}}"

tests:
  - name: "JSON request body"
    requests:
      - method: POST
        path: /api/data
        headers:
          Content-Type: application/json; charset=utf-8
          Accept: application/json
          User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
          Accept-Encoding: gzip, deflate, br
          Accept-Language: en-US,en;q=0.9
          Referer: http://test.local:3008/
        body: '{"name":"test","value":123}'
    expected:
      status: 201
      body-contains:
        - "received"

  - name: "Empty request body"
    requests:
      - method: POST
        path: /api/data
        headers:
          Content-Type: application/json
          Accept: application/json, */*
          User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          Accept-Encoding: gzip, deflate
          Accept-Language: en-US,en;q=0.9,es;q=0.8
    expected:
      status: 201

  - name: "Large JSON body"
    requests:
      - method: POST
        path: /api/data
        headers:
          Content-Type: application/json
          Accept: application/json
          User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/121.0
          Accept-Encoding: gzip, deflate, br
          Accept-Language: en-US,en;q=0.5
        body: '{"data":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris."}'
    expected:
      status: 201
