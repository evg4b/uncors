name: "Cache Configuration"
description: "Test cache headers and configuration"

backend:
  endpoints:
    - path: /api/cached2
      method: GET
      response:
        status: 200
        headers:
          Content-Type: application/json
        body: '{"test":"multiple-requests","cached":false}'

    - path: /api/cached3
      method: POST
      response:
        status: 201
        headers:
          Content-Type: application/json
        body: '{"created":true,"cached":false}'

    - path: /api/uncached
      method: GET
      response:
        status: 200
        headers:
          Content-Type: application/json
        body: '{"cached":false}'

    - path: /images/logo.png
      method: GET
      response:
        status: 200
        headers:
          Content-Type: image/png
        body: 'fake-image-data'

uncors:
  http-port: 3014
  mappings:
    - from: http://localhost:3014
      to: "{{backend}}"
      cache:
        - /api/cached*
        - /images/*

tests:
  - name: "Cached endpoint - backend called only once for multiple requests"
    request:
      method: GET
      path: /api/cached2
    repeat: 5
    backend-calls-count: 1
    expected:
      status: 200
      body-json:
        test: multiple-requests
        cached: false

  - name: "Wildcard cache pattern - backend called only once"
    request:
      method: GET
      path: /images/logo.png
    repeat: 3
    backend-calls-count: 1
    expected:
      status: 200

  - name: "Uncached endpoint - backend called every time"
    request:
      method: GET
      path: /api/uncached
    repeat: 3
    backend-calls-count: 3
    expected:
      status: 200
      body-json:
        cached: false

  - name: "POST requests bypass cache - backend called every time"
    request:
      method: POST
      path: /api/cached3
      headers:
        Content-Type: application/json
      body: '{"test":"data"}'
    repeat: 2
    backend-calls-count: 2
    expected:
      status: 201
      body-json:
        created: true
