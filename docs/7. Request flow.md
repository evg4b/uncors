# Request Flow

This diagram illustrates how UNCORS processes requests and responses between the client and upstream server.

```mermaid
sequenceDiagram
    participant Client
    participant UNCORS
    participant Upstream Server

    alt OPTIONS Request (CORS Preflight)
        Client->>UNCORS: OPTIONS /api/users
        Note over UNCORS: Handles locally<br/>Returns CORS headers
        UNCORS->>Client: 200 OK<br/>Access-Control-Allow-*
    end

    alt Standard Request Flow
        Client->>UNCORS: GET /api/users
        Note over UNCORS: 1. Check static files<br/>2. Check mocks<br/>3. Check cache
        Note over UNCORS: 4. Rewrite URL<br/>5. Transform headers/cookies
        UNCORS->>Upstream Server: GET https://api.example.com/api/users
        Upstream Server->>UNCORS: 200 OK + Response Data
        Note over UNCORS: 1. Add CORS headers<br/>2. Transform URLs<br/>3. Cache if configured
        UNCORS->>Client: 200 OK + Response Data
    end
```

## Request Processing Order

UNCORS processes each request through the following stages:

1. **OPTIONS Handling**: CORS preflight requests are handled locally (unless disabled)
2. **Static Files**: Check if path matches configured static file directories
3. **Mocks**: Check if request matches any mock configurations
4. **Cache**: Check if a cached response exists (for configured paths)
5. **Rewrites**: Apply path and host rewriting rules
6. **Proxy**: Forward request to upstream server
7. **Transform**: Modify response headers and add CORS headers
8. **Cache Store**: Store response in cache if applicable

## URL and Header Transformation

### Request (Client → Server)

- Source domain URLs in headers are replaced with target domain
- Cookie domains are rewritten to match target server
- Authorization and authentication headers are preserved

### Response (Server → Client)

- Target domain URLs in headers are replaced with source domain
- Cookie domains are rewritten to match client origin
- CORS headers are added or modified
- Location headers (redirects) are transformed to use source domain
